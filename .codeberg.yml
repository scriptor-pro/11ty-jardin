# Nom du pipeline (facultatif, mais utile pour l'identification)
pipeline:
  - name: Build, Commit & Push 11ty site to Codeberg
    image: node:18  # Utilise Node.js 18 (ajuste si ton projet nÃ©cessite une autre version)
    steps:
      # Ã‰tape 1 : Installer les dÃ©pendances
      - name: Install dependencies
        command: npm install

      # Ã‰tape 2 : Construire le site 11ty
      - name: Build 11ty site
        command: npm run build  # Assure-toi que ce script existe dans package.json

      # Ã‰tape 3 : Configurer Git pour les commits automatisÃ©s
      - name: Configure Git
        command: |
          git config --global user.email "bot@example.com"  # ðŸ‘ˆ PERSONNALISE : ton email
          git config --global user.name "CI Bot"            # ðŸ‘ˆ PERSONNALISE : ton nom ou alias

      # Ã‰tape 4 : Ajouter les fichiers gÃ©nÃ©rÃ©s (ex: _site/) au commit
      - name: Add built files to commit
        command: |
          git add _site/  # ðŸ‘ˆ PERSONNALISE : le dossier de sortie de 11ty (gÃ©nÃ©ralement _site/ ou dist/)
          git status       # Optionnel : affiche les fichiers ajoutÃ©s

      # Ã‰tape 5 : Commit avec message dynamique
      - name: Commit built site
        command: |
          git commit -m "Auto-build: $(date '+%Y-%m-%d %H:%M:%S')"  # ðŸ‘ˆ PERSONNALISE : message si besoin

      # Ã‰tape 6 : Pousser vers Codeberg (nÃ©cessite un token)
      - name: Push to Codeberg
        command: |
          git remote set-url origin https://$CODEBERG_TOKEN@codeberg.org/monutilisateur/mondepot.git  # ðŸ‘ˆ PERSONNALISE : ton URL
          git push origin main  # ðŸ‘ˆ PERSONNALISE : branche cible (main, master, etc.)

    # Variables d'environnement sÃ©curisÃ©es
    environment:
      CODEBERG_TOKEN:
        secure: "abc123def456ghi789"  # ðŸ‘ˆ PERSONNALISE : gÃ©nÃ¨re un token sur Codeberg â†’ Settings â†’ Personal Access Tokens
