{% extends "base.njk" %}

{% block content %}

<article class="note">

  {# -----------------------------------------------------------
     TITRE + STATUT
     ----------------------------------------------------------- #}
  <header class="note-header">
    {% set effectiveStatus = status %}
    {% if tags and ("cqja" in tags) %}
      {% set effectiveStatus = "cqja" %}
    {% endif %}

    <h1 class="note-title">
      {{ title }}
      {% if effectiveStatus %}
        <span class="note-status status-icon">
          {{ effectiveStatus | statusIcon }}
        </span>
      {% endif %}
    </h1>
  </header>

  {# -----------------------------------------------------------
     META
     ----------------------------------------------------------- #}
  {% set notePath %}
    {% if page and page.url %}
      {{ page.url
        | replace(r/^\\//, "")
        | replace(r/\\/$/, "") }}
    {% elseif fileSlug %}
      notes/{{ fileSlug | safelink }}
    {% endif %}
  {% endset %}
  {% set notePath = notePath | trim %}

  {% if id or date or updated or notePath %}
    {% set metaTitleId = "note-meta-" ~ (page.fileSlug or id or "infos") %}
    <section class="note-meta note-meta-block" aria-labelledby="{{ metaTitleId }}">
      <h2 class="sr-only" id="{{ metaTitleId }}">Informations sur la note</h2>
      <dl class="note-meta-list">
        {% if notePath %}
        <div class="note-meta-item">
          <dt>Chemin</dt>
          <dd class="note-path">{{ notePath }}</dd>
        </div>
        {% endif %}
        {% if id %}
        <div class="note-meta-item">
          <dt>Identifiant</dt>
          <dd class="note-id">Note #{{ id }}</dd>
        </div>
        {% endif %}
        {% if date %}
        <div class="note-meta-item">
          <dt>Créée</dt>
          <dd class="note-date">{{ date | formatDateBE }}</dd>
        </div>
        {% endif %}
        {% if updated %}
        <div class="note-meta-item">
          <dt>Modifiée</dt>
          <dd class="note-updated">{{ updated | formatDateBE }}</dd>
        </div>
        {% endif %}
      </dl>
    </section>
  {% endif %}

  {# -----------------------------------------------------------
     TAGS
     ----------------------------------------------------------- #}
  {% if tags %}
  <section class="note-tags">
    <h3 class="section-title">Tags</h3>
    <p>
      {% for tag in tags %}
        {% if tag != "note" %}
          <a class="note-tag" href="/tags/{{ tag | safelink }}/">{{ tag }}</a>
        {% endif %}
      {% endfor %}
    </p>
  </section>
  {% endif %}

  {# -----------------------------------------------------------
     CONTENU PRINCIPAL DE LA NOTE
     ----------------------------------------------------------- #}
  <section class="note-body">
    {{ content
      | stripLeadingTitle(title)
      | replace("<h1", "<h2")
      | replace("</h1>", "</h2>")
      | safe }}
  </section>




  {# -----------------------------------------------------------
     BACKLINKS
     ----------------------------------------------------------- #}
  {% if backlinks and backlinks.length > 0 %}
  <section class="note-backlinks">
    <h3 class="section-title">Backlinks</h3>

    <ul>
      {% for link in backlinks %}
        <li>
          <a href="/notes/{{ link.slug }}/">
            {{ link.title }}
          </a>
        </li>
      {% endfor %}
    </ul>
  </section>
  {% endif %}

</article>

{% endblock %}
